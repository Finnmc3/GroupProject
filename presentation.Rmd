---
title: "Income Inequality"
subtitle: "Looking at income Inequality and determining income class based on identity variabes"
author: "The Best Team <br> Finn, Tom, Jon, Scott, Roman"
institute: "University of Edinburgh"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      
---

```{r install-package, include = FALSE, eval = FALSE}
# Copy and paste the following code into your console to download and install
# the `xaringan` package that contains all of the code which allows you 
# to create presentation slides in Rmarkdown
install.packages('xaringan')
```


```{r load-packages, include = FALSE}
# Add any additional packages you need to this chunk
library(tidyverse)
library(tidymodels)
library(palmerpenguins)
library(knitr)
library(xaringanthemer)
```

```{r setup, include=FALSE}
# For better figure resolution
knitr::opts_chunk$set(fig.retina = 3, dpi = 300, fig.width = 6, fig.asp = 0.618, out.width = "80%")
```

```{r load-data, include=FALSE}

setwd("~/IDS/GroupProject/data/census+income")
adult_data <- read.csv("adult.data")
adult_test <- read.csv("adult.csv")

#Changing the variable names for adult data
colnames(adult_data) <- c("age", "workclass", "id", "education", "education-num", "marital-status", "occupation", "relationship", "race_old", "sex", "capital_gain", "capital_loss", "hours-per-week", "native-country", "class")

#Here we have transformed the race variable to make it binary depending on if the person is white or not (1 for white 0 for other)
is_white <- function(x){ifelse(x == " White", 1, 0)}

adult_data <- adult_data %>% mutate(race = is_white(race_old))
adult_data <- adult_data %>% select(-race_old)


#Here we have created a new "has degree" variable which is a binary value taking on 1 if the person has a degree
has_degree <- function(x){ifelse(x == " Bachelors" | x == " Masters" | x == " Doctorate", 1, 0)}

adult_data <- adult_data %>% mutate(has_degree = has_degree(education))
adult_data <- adult_data %>% 
  select(-capital_gain, -capital_loss)

```

```{r include=FALSE}

#Background image
style_xaringan(
  title_slide_background_image = "img/confetti.jpg"
)
```

class: center, middle

## Reasearching income inequality

By extracting data on over 32000 people from a census taken in 1994 by UCLA we aim to find out which variables, such as gender, race and age, have the largest affect on a persons income. Hence our research into the income inequality between identities should make clear whether or not their is any clear prejudice between certain types of people and if so which types of people are discriminated against the most. Furthermore we will then extrapolate this data using modeling methods in order to predict a persons class based on their identity.

Keep in mind that our research is not large enough scale to consider more than two gender's - however if we were to continue to research deeply into the topic then other sex's would most certainly be of utmost consideration.

---

class: inverse, center, middle

#Visualization of our key data points

---

# Gender vs class
.pull-left[ Here we have a plot that demonstrates a clear discrepancy between the income class of males and females. Note that our "Class" variable is binary as it takes on only the values "above 50 k" and "below 50k". With this is mind we can see that males are almost 3 times more likeyl to be "upper class" than that of ]
.pull-right[]
```{r warning=FALSE, out.width="50%", fig.width=4, echo=FALSE}
# see how I changed out.width and fig.width from defaults
# to make the figure bigger
percentage_sex_data <- adult_data %>%
  group_by(sex, class) %>%
  summarize(count = n()) %>%
  mutate(percentage = count / sum(count) * 100)


percentage_sex <- ggplot(percentage_sex_data, aes(x = sex, y = percentage, fill = class)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_text(aes(label = paste0(round(percentage, 1), "%")), vjust = -0.5, position = position_dodge(width = 0.9)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

percentage_sex ##create some more pages with graphs and explaning them
```
---

class: inverse, center, middle

#Logistic regression

---
#Logistic regression results

After careful consideration we came to conclusion that sex, race and university degrees were the most interesting predictors of a persons income and also from the plots above there seems to be a clear disparity within them. Therefore, in an attempt to keep our model as simple as possible, our logistic regression uses only sex, race and degree as predictors. This resulted in the following table:

```{r logistics-table, echo = FALSE}
adult_data$class <- factor(adult_data$class)

class_fit <- logistic_reg() %>%
  set_engine("glm") %>%
  fit(class ~ race + sex + has_degree, data = adult_data, family = "binomial")

tidy(class_fit)
```
note that we transformed the data in such a way that race takes on the value 1 if the person is white and 0 otherwise. This is because we wanted to see specifically how being in a minority may affect people and it also allows the data to be further simplified leading to better predictions.


---
#Creating our prediction model

By using the data from the previous slide we arrive at the following model:

 $\log\left(\frac{p}{1 - p}\right) = -2.96 + 0.494 \times \text{race} + 1.3 \times \text{sex} + 1.45 \times \text{degree}$

<br>

--
Which means that:

$p = \frac{1}{1 + e^{2.96 - 0.494 \times \text{race} - 1.3 \times \text{sex} - 1.45 \times \text{degree}}}$

--

We then turned this data into a table to look at the results. Notice that a white male with a degree is over 11 times more likely to be of an upper class income status than that of a non-white female with no degree:
<br>
```{r dataframe, echo = FALSE}
data.frame(
race = c( 1, 0, 1, 1, 0, 0, 1, 0),
sex = c( 1, 1, 0, 1, 0, 1, 0, 0),
degree = c( 1, 1, 1, 0, 1, 0, 0, 0),
p = c("57%", "48%", "27%", "24%", "18%", "16%", "8%", "5%")
)
```



---

class: inverse, middle, center

# Using xaringan

---

# xaringan

- The presentation is created using the `xaringan` package

- Use `---` to separate slides and `--` for incremental builds

--

- Like this

---

# Layouts

You can use plain text

- or bullet points

.pull-left[
or text in two columns $^*$
]
.pull-right[
- like
- this
]

.footnote[
[*] And add footnotes
]

---

# Code

```{r boring-regression}
# a boring regression
model <- lm(dist ~ speed, data = cars)
tidy(model)
glance(model)
```

---

# Plots

```{r recode-species, echo = FALSE}
# In this chunk I'm doing a bunch of analysis that I don't want to present 
# in my slides. But I need the resulting data frame for a plot I want to present.
iris_modified <- iris %>%
  mutate(Species = fct_other(Species, keep = "setosa"))
```

```{r plot-iris, echo = FALSE}
# Code hidden with echo = FALSE
# Uses modified iris dataset from previous chunk
# Play around with height and width until you're happy with the look
ggplot(data = iris_modified, mapping = aes(x = Sepal.Width, y = Sepal.Length, color = Species)) +
  geom_point() + 
  theme_minimal() # theme options: https://ggplot2.tidyverse.org/reference/ggtheme.html
```

---

## Plot and text

.pull-left[
- Some text
- goes here
]
.pull-right[
```{r warning=FALSE, out.width="100%", fig.width=4, echo=FALSE}
# see how I changed out.width and fig.width from defaults
# to make the figure bigger
ggplot(penguins, aes(x = bill_length_mm, y = species, color = species)) +
  geom_boxplot() +
  theme_minimal()
```
]

---

# Tables

If you want to generate a table, make sure it is in the HTML format (instead of Markdown or other formats), e.g.,

```{r iris-table, echo = FALSE}
kable(head(iris), format = "html")
```

---

# Images

```{r castle, echo = FALSE, out.width = "55%", fig.align = "center", fig.cap = "Image credit: Photo by JÃ¶rg Angeli on Unsplash."}
include_graphics("img/edinburgh-castle.jpg")
```

Or you can also include a full page image. See next slide.

---


class: inverse, center, middle
background-image: url(img/edinburgh-castle.jpg)
background-size: contain
---

# Math Expressions

You can write LaTeX math expressions inside a pair of dollar signs, e.g. &#36;\alpha+\beta$ renders $\alpha+\beta$. You can use the display style with double dollar signs:

```
$$\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i$$
```

$$\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i$$

Limitations:

1. The source code of a LaTeX math expression must be in one line, unless it is inside a pair of double dollar signs, in which case the starting `$$` must appear in the very beginning of a line, followed immediately by a non-space character, and the ending `$$` must be at the end of a line, led by a non-space character;

1. There should not be spaces after the opening `$` or before the closing `$`.

1. Math does not work on the title slide (see [#61](https://github.com/yihui/xaringan/issues/61) for a workaround).

---

# Feeling adventurous?

- Want to find out more about `xaringan`? See https://slides.yihui.name/xaringan/#1.

- You are welcome to use the default styling of the slides. In fact, that's what I expect majority of you will do. You will differentiate yourself with the content of your presentation.

- But some of you might want to play around with slide styling. The 
`xaringanthemer` provides some solutions for this that: https://pkg.garrickadenbuie.com/xaringanthemer.

- And if you want more bells and whistles, there is also `xaringanExtra`: https://pkg.garrickadenbuie.com/xaringanExtra.
